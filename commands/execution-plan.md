# Execution Plan - 段落式實作計畫書生成器

為軟體開發專案生成**段落式實作計畫書**，基於 Story Design 的 4-Stage 設計成果，執行分段實作與品質保證，專為功能實現、Examples驅動開發和品質保證設計。

**🚨 重要**: 此命令基於 `/story-design` 的 SD1-SD4 成果生成實作計畫書，專注於段落式實作方法論。

## 使用方式
```bash
/execution-plan "實作任務描述" [可選：PROMPT檔案路徑]
```

---

## 🎯 核心概念：Self-Contained Segment

### 什麼是 Self-Contained Segment？

**🎯 核心定義**：
每個實作段落都是**完全獨立的功能單元**，AI 只需讀取該段落就能完成實作，無需依賴其他段落。

**📋 Self-Contained 特徵**：
- **Context 獨立**: 包含所需的所有背景資訊和依賴
- **功能完整**: 段落內容構成一個完整的功能
- **驗證自足**: 包含完整的測試和驗證策略
- **執行獨立**: 可以獨立實施而不影響其他段落

### **段落式實作的價值**

**🚀 核心優勢**：
- **降低複雜度**: 將複雜功能分解為多個簡單段落
- **提高成功率**: 每個段落都有明確的完成標準
- **便於調試**: 獨立段落更容易定位和修復問題
- **靈活執行**: 可以根據優先級選擇執行段落

**🎯 適用情境**：
- **複雜功能開發**: 將大型功能分解為多個段落
- **多人協作**: 不同團隊成員可以並行開發不同段落
- **漸進式交付**: 可以分階段交付價值
- **品質保證**: 每個段落都有獨立的驗證機制

---

## 🎭 角色定位與專業範圍

### **適用情境** (何時使用此命令)

**✅ 適用情境**:
- **基於 Story Design**: 已完成 SD1-SD4 設計，需要具體實作規劃
- **複雜功能實作**: 需要分段實作的複雜功能
- **團隊協作開發**: 需要多人並行開發的專案
- **品質保證要求**: 需要嚴格驗證和測試的專案

**❌ 不適用情境**:
- **簡單功能**: 可直接實作的簡單功能
- **缺乏設計基礎**: 未完成 SD1-SD4 分析設計的專案
- **緊急修復**: 需要快速解決的技術問題

### **核心角色分工**

#### **基於 Story Design 的實作規劃**
- **主導角色**: AI 實作規劃師
- **行為模式**: 智能段落劃分 + Self-Contained 設計
- **交付成果**: 段落式實作計畫書

#### **與 /impl 命令的協作**
- **主導角色**: AI 實作工程師
- **行為模式**: Examples 驅動開發 + 品質保證
- **交付成果**: 可執行的功能實作

---

## 📚 專業知識庫 (強制自動載入)

🚨 **必須按順序載入以下核心文檔**：
1. CLAUDE.md - 基礎行為準則與環境約束
2. session_notes.md - 當前任務狀態
3. Story Design 設計文檔 - SD1-SD4 完整設計成果

---

## 📋 段落設計標準

### **每個段落必須包含的要素**

#### **1. 段落概要 (Context)**
- **背景資訊**: 為於 Story Design 的分析結果
- **依賴關係**: 與其他段落的依賴和整合點
- **技術選型**: 確定的技術方案和工具
- **成功標準**: 明確的完成檢查清單

#### **2. 核心實作要點**
- **主要類別**: 需要實現的核心類別和介面
- **關鍵方法**: 重要方法的實現要點和邏輯
- **設計決策**: 重要的技術決策和理由
- **整合方式**: 與現有系統的整合方法

#### **3. 程式碼框架 (Pseudo Code)**
- **類別結構**: 主要類別的完整 Pseudo Code
- **方法實現**: 重要方法的實現框架
- **Call Stack**: 完整的函數調用鏈
- **錯誤處理**: 例外處理和驗證邏輯

##### **📁 檔案結構展示方式**
使用類似檔案樹的方式展示，而非抽象的mermaid圖表：
```
[project_name]/
├── [module_name]/
│   ├── core_class.py              # 核心系統組件
│   ├── feature_a.py                # 功能組件 A
│   └── feature_b.py                # 功能組件 B
```

##### **🏗️ 空殼class設計方式**
提供詳細註解的class結構，讓人掃讀就能理解設計意圖：
```python
# [project_name]/[module]/core_component.py

class ComponentFactory:
    """
    統一組件創建入口，解決段落式實作的依賴問題
    設計目標：提供高性能的資源管理策略
    """
    def __init__(self, config: Dict[str, Any]):
        """配置驅動初始化，支援策略設定"""
        pass

    def create_component(self, name: str, data: pd.DataFrame,
                        strategy: str = 'optimized') -> Component:
        """創建組件，內建性能優化策略"""
        pass

class CoreComponent:
    """
    核心組件，Self-Contained 實作的核心
    關鍵特性：獨立可執行、完整功能、驗證自足
    """
    def __init__(self, name: str, data: pd.DataFrame,
                 strategy: str = 'optimized'):
        """strategy控制處理方式：optimized或standard"""
        pass

    def execute(self) -> ResultType:
        """
        執行核心功能，段落的主要實作內容
        Call Stack: execute -> _validate -> _process -> _finalize
        """
        # 主要邏輯 pseudo code
        pass
```

##### **Pseudo Code設計範例**
```python
# 基於段落獨立性的設計藍圖
class SegmentProcessor:
    """
    設計意圖: 獨立處理特定功能段落，支援單獨執行驗證
    架構位置: Self-Contained Segment 核心處理器
    依賴模組: 最小化外部依賴，段落內部自足
    """
    def __init__(self, config: Dict[str, Any]):
        """
        設計意圖: 段落初始化，包含所有必要依賴
        Call Stack: __init__ -> _setup_dependencies -> _validate_config
        """
        assert isinstance(config, dict), "Config must be dictionary"
        self.config = config
        self._setup_dependencies()

    def process_segment(self, input_data: InputType) -> ResultType:
        """
        設計意圖: 段落核心處理邏輯，獨立可執行
        Call Stack: process_segment -> _validate_input -> _core_process -> _format_output
        架構考量: 確保段落內部處理所有依賴，不依賴其他段落
        整合說明: 提供標準化介面，支援與其他段落整合
        """
        validated_input = self._validate_input(input_data)  # 輸入驗證
        core_result = self._core_process(validated_input)     # 核心處理
        return self._format_output(core_result)             # 輸出格式化

    def _core_process(self, data: ProcessedType) -> CoreResult:
        """
        Call Stack: _core_process -> Helper.function -> ExternalModule.method
        """
        # 核心邏輯 pseudo code，展示調用鏈
        helper_result = Helper.process_step1(data)          # 輔助處理1
        external_result = ExternalModule.compute(helper_result)  # 外部模組調用
        return self._finalize_result(external_result)        # 最終處理
```

#### **4. 驗證策略**
- **Examples 設計**: 可執行的範例程式碼
- **測試計畫**: 單元測試和集成測試策略
- **完成檢查**: 具體的完成標準驗證
- **整合測試**: 與其他段落的整合驗證

---

## 🚀 執行流程

### **基於 Story Design 的段落式規劃**

```
Story Design 成果 (SD1-SD4)
         ↓
    智能段落分析和劃分
         ↓
    Self-Contained Segment 設計
         ↓
    段落式實作計畫書生成
         ↓
    段落式執行和驗證
```

### **智能段落劃分原則**

#### **1. 功能完整性原則**
- 每個段落都構成一個完整的功能
- 段落內容具有明確的業務價值
- 避免功能過於小或過於大

#### **2. 依賴獨立性原則**
- 最小化段落間的依賴關係
- 必要的依賴在段落內部處理
- 清晰定義段落邊界和介面

#### **3. 實作可行性原則**
- 每個段落都有明確的實作路徑
- 技術複雜度控制在合理範圍
- 有足夠的資訊指導實作

#### **4. 驗證自足性原則**
- 每個段落都有獨立的驗證策略
- 包含完整的測試和驗證方法
- 有明確的完成標準檢查

---

## 🔧 OpenSpec 行為規範 (執行階段)

### **OpenSpec 在 execution-plan 中的角色**

**🎯 核心定位**：
- **分析行為規範**: 指導 AI 進行系統化的段落分析
- **品質保證機制**: 確保段落設計的完整性和可行性
- **驗證指導框架**: 提供段落驗證的結構化方法

### **行為規範要求**

#### **1. 段落分析行為**
- **深度分析**: 基於 Story Design 成果進行深度分析
- **依賴識別**: 識別段落間的依賴關係
- **可行性評估**: 評估每個段落的實作可行性

#### **2. 段落設計行為**
- **結構化設計**: 使用統一的段落設計框架
- **完整性檢查**: 確保每個段落包含所有必要要素
- **驗證策略設計**: 設計完整的測試和驗證方法

#### **3. 交付物驗證行為**
- **格式一致性**: 確保所有段落使用統一的格式
- **完整性驗證**: 檢查是否包含所有必要資訊
- **可執行性驗證**: 確保段落可以獨立執行

---

## 📋 執行規範和品質保證

### **段落設計檢查清單**

每個設計完成的段落必須通過以下檢查：

```markdown
## Self-Contained Segment 檢查清單
- [ ] 段落標題明確且獨立
- [ ] Context 包含所有必要背景資訊
- [ ] 核心實作要點清晰具體
- [ ] Pseudo Code 提供完整實作框架
- [ ] Examples 設計涵蓋主要使用場景
- [ ] 驗證策略完整且可執行
- [ ] 完成檢查標準明確可測量
- [ ] 與其他段落整合點清晰定義
```

### **錯誤修復指導**

當段落設計不符合標準時：

**問題**: 段落過於依賴其他段落
**修復方式**:
1. 識別並最小化段落間依賴
2. 在段落內部處理必要依賴
3. 重新劃分段落邊界

**問題**: Pseudo Code 不完整
**修復方式**:
1. 補充缺失的核心類別和方法
2. 完善 Call Stack 展示
3. 添加錯誤處理邏輯

**問題**: 驗證策略不充分
**修復方式**:
1. 設計涵蓋主要功能場景的 Examples
2. 完善測試計畫和整合測試
3. 定義具體的完成標準檢查

---

## 🚀 與其他命令的整合

### **執行鏈路**
```
/story-design → /execution-plan → /impl
```

### **命令協作模式**
- **story-design**: 提供 SD1-SD4 設計成果
- **execution-plan**: 基於設計成果生成段落式實作計畫書
- **impl**: 執行具體的段落式實作

### **資訊流動**
- **設計到實作**: Story Design → Execution Plan
- **實作到驗證**: Execution Plan → impl → Examples 驗證
- **驗證到調整**: impl 結果 → 調整後續段落

---

## 📚 成功案例與最佳實踐

### **成功段落特徵**
- **獨立可執行**: 段落可以獨立完成實作和測試
- **價值明確**: 段落提供具體的業務價值
- **驗證完整**: 包含完整的測試和驗證策略
- **整合清晰**: 與其他段落的整合點明確

### **最佳實踐總結**
- **功能完整性**: 確保每個段落都是完整的功能單元
- **依賴最小化**: 最小化段落間的依賴關係
- **驗證自足**: 每個段落都有獨立的驗證機制
- **文檔一致性**: 使用統一的段落設計格式

## 📋 Execution Plan 計畫書品質檢查

### **段落設計規劃完整性**
- [ ] 智能段落劃分原則明確且可執行
- [ ] 每個段落包含 Context、核心實作要點、Pseudo Code、驗證策略
- [ ] **🚨 Self-Contained 設計**：每個段落獨立可執行
- [ ] **🚨 Pseudo Code 完整性**：包含類別結構、Call Stack、錯誤處理
- [ ] **🚨 驗證策略設計**：Examples、測試計畫、整合測試
- [ ] 段落間依賴最小化且有清晰定義

### **Self-Contained 檢查**
- [ ] 段落包含所有必要背景資訊
- [ ] 核心實作要點清晰具體
- [ ] Pseudo Code 提供完整實作框架
- [ ] 驗證策略完整且可執行
- [ ] 與其他段落整合點清晰定義

### **專案相關性檢查**
- [ ] 基於 Story Design SD1-SD4 成果
- [ ] 段落劃分符合專案複雜度
- [ ] 實作策略符合團隊協作需求
- [ ] 品質保證機制完善且可執行

---

## 📊 Execution Plan 輸出標準

### **段落式實作計畫書標準結構**

```markdown
# Execution Plan - [專案名稱]

## 🎯 實作總覽
- **基於設計**: Story Design SD1-SD4 成果
- **段落策略**: Self-Contained Segment 分段實作
- **品質保證**: Examples 驅動驗證

## 📋 段落劃分策略
### 段落 1: [段落名稱]
#### Context
[背景資訊和依賴關係]

#### 核心實作要點
[主要類別和關鍵方法]

#### 程式碼框架
[Pseudo Code 設計]

#### 驗證策略
[Examples 和測試計畫]

### 段落 2: [段落名稱]
[重複相同結構]

## 🔄 整合策略
- **段落間依賴**: [依賴關係說明]
- **整合測試**: [整合驗證計畫]
- **品質保證**: [整體品質檢查清單]
```

### **交付物要求**
- **✅ 單一實作計畫書**: 包含所有段落設計
- **✅ Self-Contained 段落**: 每個段落獨立可執行
- **✅ 完整驗證策略**: Examples + 測試計畫
- **✅ 整合計畫**: 段落間整合和驗證策略

## 🔧 輸出和後續行動

### **直接輸出**
1. **計畫書路徑**: 提供完整的 Execution Plan 檔案位置
2. **段落規劃摘要**: Self-Contained Segment 的核心劃分和重點
3. **實作依賴**: 與 Story Design 的對應關係說明
4. **品質保證**: 段落檢查清單和驗證策略

### **後續行動建議**
- **開始執行**: 使用 `/impl` 基於段落式計畫書執行具體實作
- **段落優先級**: 根據依賴關係和業務價值確定執行順序
- **持續驗證**: 每個段落完成後立即進行驗證
- **整合測試**: 所有段落完成後進行整體整合驗證

### **品質保證提醒**
- **段落獨立驗證**: 確保每個段落都可以獨立執行和測試
- **依賴最小化**: 實作過程中確保段落間依賴的清晰定義
- **持續整合**: 段落完成後立即進行與現有系統的整合測試
- **文檔同步**: 實作過程中同步更新設計文檔

---

**重要**: 此命令專注於段落式實作計畫書生成，為段落實作提供詳細指導。系統分析請使用 `/story-design`，具體實作請使用 `/impl`。

**🚨 強制要求**:
- 段落設計必須基於 Story Design SD1-SD4 成果
- **🏗️ 必須產生完整段落式計畫書**：包含所有 Self-Contained 設計
- **🚨 Pseudo Code 設計為核心交付物**：必須包含完整的實作框架
- **🚨 Self-Contained 段落檢查**：必須通過獨立可執行驗證
- **🚨 驗證策略完整性**：必須包含 Examples 和測試計畫
- **段落依賴最小化**：必須最小化段落間依賴關係
- **品質保證機制**：必須包含完整的檢查清單和驗證策略

**最後更新**: 2025-10-26
**文檔版本**: v2.0 - Self-Contained Segment 導向版本
**核心改進**: 專注段落式實作方法論，恢復所有專業設計細節