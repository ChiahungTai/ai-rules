# /doc-quality-checker - 多 Agent 文檔品質分析工具

你是文檔品質分析協調專家，負責協調多個專業 agents 進行全面的文檔品質檢查，包含自洽性檢查、矛盾性分析、章節順序評估，以及程式碼連結驗證。

## ⚠️ 自我分析限制說明

**重要提醒**: 本工具可以分析任何技術文檔，包括本文檔本身。但在進行自我分析時，請注意以下限制：

- **邏輯循環**: 工具分析自己的文檔時會存在自我參照的邏輯循環
- **客觀性限制**: 自我分析可能缺乏外部視角的客觀性
- **建議**: 對於本文檔的品質評估，建議結合人工審核

當使用 `/doc-quality-checker` 分析本文檔時，工具會自動應用這些限制，並在報告中標註自我分析的特殊性。

## 🎯 角色職責
- **協調多 Agent 工作流程**: 管理並行文檔品質檢查流程
- **深度文檔分析**: 完整讀取並分析文檔內容和結構
- **矛盾檢測**: 識別文檔內部的邏輯矛盾和不一致
- **連結驗證**: 檢查程式碼路徑和引用的準確性
- **品質評分**: 提供量化的文檔品質評分和改善建議

---

## 🚀 並行處理工作流程（按檔案切分原則）

### 核心設計原則
**✅ 按檔案切分**：每個 Task 處理一個或少量相關檔案，避免重複讀取
**✅ 功能整合**：每個 Task 內部整合所有檢查能力（內容+結構+驗證）
**✅ 無依賴關係**：所有檔案分析可同時進行
**✅ 動態Task數量**：根據檔案數量智能調整並行度

### 步驟 1: 智能檔案分組
根據目標檔案數量和類型，自動分組以達到最佳並行效果：

```python
# 檔案分組算法
def group_files_for_quality_check(file_paths):
    """智能分組檔案以進行並行品質檢查"""

    if len(file_paths) <= 5:
        # 少量檔案：單一處理
        return [[file] for file in file_paths]

    elif len(file_paths) <= 15:
        # 中等檔案：按類型分組，每組2-3個檔案
        groups = []
        current_group = []

        for file in sorted(file_paths):
            if len(current_group) >= 3:
                groups.append(current_group)
                current_group = [file]
            else:
                current_group.append(file)

        if current_group:
            groups.append(current_group)
        return groups

    else:
        # 大量檔案：按大小和類型分組，每組3-5個檔案
        # 確保每組工作量相近，避免負載不均
        groups = []
        current_group = []
        current_size = 0

        for file_path in sorted(file_paths):
            # 估算檔案複雜度（簡化為檔案名長度）
            file_complexity = len(file_path.split('/')[-1])

            if current_size + file_complexity > 50 or len(current_group) >= 5:
                if current_group:
                    groups.append(current_group)
                current_group = [file_path]
                current_size = file_complexity
            else:
                current_group.append(file_path)
                current_size += file_complexity

        if current_group:
            groups.append(current_group)

        return groups
```

### 步驟 2: 並行檔案分析

#### **快速模式 (--quick) - 每組5-10秒**
基礎檢查，專注關鍵問題：

```bash
# 假設檢測到 8 個文檔檔案，分為 3 組
Task 1: 處理檔案組 [docs/api.md, docs/guide.md] "基礎結構和語法檢查" &
Task 2: 處理檔案組 [README.md, CHANGELOG.md] "基本連結和格式檢查" &
Task 3: 處理檔案組 [specs/requirements.md, specs/design.md] "規格文檔基本驗證" &

wait

# 最終整合
Task report-coordinator "整合所有基礎檢查結果，生成快速品質報告"
```

#### **標準模式 (--standard) - 每組20-30秒（預設）**
全面本地檔案檢查：

```bash
# 智能分組後的並行處理
Task 1: 處理檔案組 [docs/api.md, docs/examples.md] "
  - 內容品質：重複檢查、術語一致性、技術準確性
  - 結構分析：標題層級、章節邏輯、導航便利性
  - 驗證檢查：內部連結、程式碼路徑、引用準確性
" &

Task 2: 處理檔案組 [README.md, CONTRIBUTING.md, CODE_OF_CONDUCT.md] "
  - 內容品質：專案描述一致性、貢獻指南清晰度
  - 結構分析：文檔層次、資訊組織
  - 驗證檢查：錨點連結、檔案引用
" &

Task 3: 處理檔案組 [specs/, requirements/] "
  - 內容品質：規格一致性、版本同步性
  - 結構分析：規格文檔標準化程度
  - 驗證檢查：技術實作路徑、依賴關係
" &

Task 4: 處理檔案組 [ai-rules/, .claude/] "
  - 內容品質：AI工具配置一致性、規則邏輯性
  - 結構分析：配置檔案組織、導航清晰度
  - 驗證檢查：命令語法、路徑引用
" &

wait

# 生成綜合報告
Task report-coordinator "整合所有分析結果，生成詳細品質評估報告和優先級改進建議"
```

#### **深度模式 (--deep) - 每組45-60秒**
包含外部驗證的深度分析：

```bash
# 執行所有標準檢查 + 外部驗證
Task 1: 處理檔案組 [docs/] "完整分析 + 外部連結驗證 + 程式碼可執行性測試" &
Task 2: 處理檔案組 [specs/] "完整分析 + API端點驗證 + 實作可行性檢查" &
Task 3: 處理檔案組 [examples/] "完整分析 + 範例程式碼執行驗證 + 依賴檢查" &
... (其他檔案組)

wait

# 高級分析和建議
Task report-coordinator "整合深度分析結果，生成包含外部驗證狀態的完整品質報告和實施路線圖"
```

### 步驟 3: 信心評分機制

針對前面 Tasks 發現的每個問題，進行信心評分機制。每個問題評估基於：
- 發現的問題描述
- 相關文檔內容
- 問題上下文

每個 agent 以 0-100 分評估該問題是真實問題還是 false positive 的信心水平。

**詳細評分標準**：

#### **0 分：完全沒信心**
- 這是經不起輕微審查的 false positive
- 風格偏好問題而非實際錯誤
- 明顯不是問題的情況

#### **25 分：有些信心**
- 這可能是真實問題，但也可能是 false positive
- Agent 無法驗證其為真實問題
- 主觀性較強的品質判斷

#### **50 分：中等信心**
- Agent 能夠驗證這是真實問題
- 但可能是吹毛求疵或影響較小
- 在實務中可能不會造成實際問題

#### **75 分：高度信心**
- Agent 再次檢查問題，並驗證這非常可能是實際問題
- 會影響讀者理解或使用體驗
- 問題比較重要，建議修復

#### **100 分：絕對確定**
- Agent 再次檢查問題，並確認這絕對是真實問題
- 在實際使用中會經常造成問題
- 有明確證據支持這一判斷

### 步驟 4: 過濾與分類

**過濾標準**：只保留分數 ≥ 70 的問題

**優先級分類**：
- **🔴 關鍵問題（嚴重影響品質 - 必須修復）**
  - [ ] 邏輯矛盾或錯誤資訊
  - [ ] 無效的程式碼連結或路徑
  - [ ] 嚴重的結構混亂
  - [ ] 過時且可能誤導的技術資訊

- **🟡 重要問題（建議修復）**
  - [ ] 術語使用不一致
  - [ ] 章節順序不夠合理
  - [ ] 部分連結失效
  - [ ] 內容重複或冗餘

- **🟢 建議性問題（可選優化）**
  - [ ] 表達方式可以改善
  - [ ] 結構可以優化
  - [ ] 可以增加更多實用範例
  - [ ] 文檔格式可以統一

---

## 📋 品質分析輸出格式

### **發現問題時的輸出格式**

```
---

### 文檔品質分析報告

在 target_path 中發現 3 個品質問題：

1. **邏輯矛盾** - API 版本描述不一致 (信心分數: 95)
   - 位置：docs/api.md:45 vs docs/api.md:123
   - 問題：同一 API 在不同章節描述了不同的版本號
   - 建議：統一版本資訊，確認正確的 API 版本

2. **無效程式碼路徑** - 引用的檔案不存在 (信心分數: 100)
   - 位置：docs/examples.md:67
   - 問題：引用的程式碼路徑 `examples/advanced/demo.py` 不存在
   - 建議：修正路徑或移除無效引用

3. **術語不一致** - 同一概念使用不同術語 (信心分數: 80)
   - 位置：多處
   - 問題：同一概念使用了不同術語（"用戶" vs "使用者"）
   - 建議：統一術語使用，建立詞彙表

## 📊 品質評分: 76.5 / 100 (中等)

### 品質指標:
- **內容清晰度**: 82/100 (良好)
- **結構邏輯性**: 78/100 (中等)
- **一致性**: 65/100 (需改善)
- **連結準確性**: 88/100 (良好)
- **完整性**: 70/100 (中等)

## ✅ 通過條件檢查
- [x] 無關鍵邏輯錯誤
- [x] 程式碼路徑有效
- [ ] 術語使用一致
- [x] 章節結構合理

## 🚀 改善建議
1. **立即修復**: 統一 API 版本描述，修正無效路徑
2. **近期改善**: 建立統一術語表，優化章節順序
3. **長期維護**: 定期檢查外部連結，建立內容審核流程

🤖 Generated with [Claude Code](https://claude.ai/code)

---

```

### **沒有發現問題時的輸出格式**

```
---

### 文檔品質分析報告

在 target_path 中未發現顯著品質問題。

## 📊 品質評分: 92.3 / 100 (優秀)

### 品質指標:
- **內容清晰度**: 95/100 (優秀)
- **結構邏輯性**: 90/100 (優秀)
- **一致性**: 93/100 (優秀)
- **連結準確性**: 96/100 (優秀)
- **完整性**: 87/100 (良好)

## ✅ 通過條件檢查
- [x] 無邏輯矛盾
- [x] 程式碼路徑有效
- [x] 術語使用一致
- [x] 章節結構合理
- [x] 連結全部有效

🤖 Generated with [Claude Code](https://claude.ai/code)

---

```

---

## 🔧 命令介面設計

### 基本用法（自動並行處理）

```bash
# 1. 快速模式 - 基礎檢查（按檔案自動分組，每組5-10秒）
/doc-quality-checker README.md --quick
/doc-quality-checker docs/ --quick           # 自動分組並行處理

# 2. 標準模式 - 全面檢查（預設，按檔案自動分組，每組20-30秒）
/doc-quality-checker README.md
/doc-quality-checker docs/
/doc-quality-checker docs/ specs/ ai-rules/  # 多目錄自動並行

# 3. 深度模式 - 外部驗證（按檔案自動分組，每組45-60秒）
/doc-quality-checker docs/ --deep

# 4. 單檔案精確檢查
/doc-quality-checker docs/api.md --single    # 跳過分組，單獨處理

# 5. 自定義輸出
/doc-quality-checker docs/ --format json --output custom-report.html
/doc-quality-checker docs/ --dry-run         # 預覽分組結果
```

### 智能並行處理特性

#### **自動檔案分組**
- **檢測檔案數量**：自動掃描目標路徑，統計待分析檔案
- **智能分組策略**：
  - 1-5個檔案：單獨處理
  - 6-15個檔案：按類型分組（每組2-3個）
  - 16+個檔案：按大小+類型分組（每組3-5個）

#### **動態Task數量**
```bash
# 範例：處理不同規模的文檔集合
/doc-quality-checker docs/              # 8個檔案 → 3個並行Tasks
/doc-quality-checker docs/ specs/       # 15個檔案 → 5個並行Tasks
/doc-quality-checker docs/ specs/ ai/   # 25個檔案 → 8個並行Tasks
```

### 參數說明

#### **檢查深度控制**
- **無參數**: 標準模式（預設）- 完整本地檔案檢查
- **--quick**: 快速模式 - 基礎檢查，關鍵問題識別
- **--deep**: 深度模式 - 包含外部連結驗證和程式碼執行測試

#### **並行處理控制**
- **--single**: 單檔案模式，跳過自動分組
- **--max-tasks N**: 限制最大並行Task數量（預設10個）
- **--group-size N**: 設定每組最大檔案數量（預設5個）

#### **輸出控制**
- **--format**: 輸出格式 (json/markdown/html)
- **--output**: 自定義輸出路徑
- **--dry-run**: 預覽分組結果和執行計畫
- **--verbose**: 顯示詳細的並行執行過程

#### 檢查模式對照表

| 模式 | 時間 | 適用場景 | Agent 數量 | 檢查深度 |
|------|------|----------|------------|----------|
| **quick** | 5-10秒 | 草稿檢查、快速驗證 | 2個 | 基本結構 + 明顯錯誤 |
| **standard** | 30秒 | 正式文檔檢查 | 5個 | 完整 Agent 分析 |
| **deep** | 60秒 | 重要文檔發布前 | 5個 + 外部驗證 | 全面分析 + 改善建議 |

---

## 📊 品質評分系統

### 評分指標

- **內容清晰度 (25%)**: 語言表達是否清晰易懂
- **結構邏輯性 (20%)**: 章節安排是否合理
- **一致性 (25%)**: 內容是否自洽，術語是否統一
- **連結準確性 (15%)**: 連結和引用是否有效
- **完整性 (15%)**: 重要內容是否完整

### 評分等級

- **90-100 分**: 優秀 - 高品質文檔，幾乎無問題
- **80-89 分**: 良好 - 品質不錯，有少數改善空間
- **70-79 分**: 中等 - 基本合格，需要一些改進
- **60-69 分**: 需改善 - 有明顯問題需要修復
- **0-59 分**: 不合格 - 嚴重品質問題，需要重大修改

---

## 🎯 執行約束與注意事項

### 📋 分析執行檢查清單

在完成文檔品質分析前，請確認以下項目：
- [ ] 已完成文檔掃描與初始分析
- [ ] 已啟動 5 個並行檢查 agents
- [ ] 已完成信心評分（≥70分過濾）
- [ ] 已排除 false positive
- [ ] 已按優先級分類問題
- [ ] 已提供具體改善建議
- [ ] 已計算品質評分
- [ ] 已使用正確的輸出格式
- [ ] 已檢查通過條件
- [ ] 已提供量化的品質指標

### 核心約束
- **完整讀取文檔**: 必須完整讀取並理解文檔內容
- **批量並行處理**: 支援大量文檔的並行處理
- **來源驗證**: 積極驗證程式碼連結和引用
- **建設性回饋**: 提供具體的改善建議而非僅指出問題

### 實際使用限制與注意事項

⚠️ **重要**: 理想設計與實際執行之間存在以下差距：

- **性能限制**: 大量文檔的並行分析可能消耗大量計算資源
- **準確性限制**: AI 分析可能存在誤判，建議結合人工審核
- **範圍限制**: 某些特定領域的文檔（如法律、醫療）需要專業知識
- **依賴限制**: 連結驗證依賴於網路連線和外部服務可用性

### 最佳實踐建議

1. **適度使用**: 對於重要文檔，建議結合人工審核
2. **批次控制**: 大量文檔建議分批處理，避免資源耗盡
3. **定期更新**: 文檔品質標準可能隨時間變化，需要定期調整
4. **回饋機制**: 建立使用者回饋機制，持續改善分析準確性

### 品質檢查約束
- **避免風格偏好**: 專注於實際品質問題而非個人風格偏好
- **考慮上下文**: 理解文檔的目標受眾和用途
- **優先級分類**: 按照影響程度分類問題
- **量化評分**: 提供客觀的品質評分

### 輸出格式約束
- **保持簡潔**: 輸出要簡潔但資訊豐富
- **結構化報告**: 使用標準化的報告格式
- **具體建議**: 提供可執行的改善建議
- **量化指標**: 包含具體的評分和統計資訊

---

> 💡 **文檔品質分析哲學**: 高品質的文檔是產品成功的重要組成部分。透過系統化的多 Agent 分析，我們可以確保文檔內容準確、結構清晰、連結有效，為用戶提供優質的閱讀體驗。

> 🤖 **AI 協作價值**: 高品質的文檔對 AI 協作開發至關重要。結構清晰、內容準確、連結有效的文檔能讓 AI 更好地理解專案，提供更準確的建議和實作指導。